<div class="mb-8">
  <h2 class="page-title">Einstellungen</h2>
  <p class="text-sm text-gray-400 mt-0.5">Verwalte Integrationen und App-Einstellungen.</p>
</div>

<!-- Konto Card -->
<div class="card max-w-lg overflow-hidden mb-6">
  <div class="px-6 pt-6 pb-4 border-b border-gray-100 dark:border-gray-700 flex items-center gap-3">
    <div class="w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
      <lucide-icon name="settings" [size]="18" class="text-primary dark:text-text-dark" aria-hidden="true"></lucide-icon>
    </div>
    <div>
      <h3 class="text-sm font-semibold text-primary dark:text-text-dark">Konto</h3>
      <p class="text-xs text-gray-400">Angemeldeter Benutzer</p>
    </div>
  </div>
  <div class="px-6 py-5 flex items-center justify-between gap-4">
    <div>
      <p class="text-sm font-medium text-gray-700 dark:text-text-dark">
        {{ authService.currentUser?.anzeigename ?? authService.currentUser?.email }}
      </p>
      <p *ngIf="authService.currentUser?.anzeigename" class="text-xs text-gray-400">
        {{ authService.currentUser?.email }}
      </p>
    </div>
    <button class="btn-secondary" (click)="logout()">
      <lucide-icon name="log-out" [size]="14" aria-hidden="true"></lucide-icon>
      Abmelden
    </button>
  </div>
</div>

<!-- Erwartete Lebensdauer Card -->
<div class="card max-w-lg overflow-hidden mb-6">

  <!-- Card header -->
  <div class="px-6 pt-6 pb-4 border-b border-gray-100 dark:border-gray-700 flex items-center gap-3">
    <div class="w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
      <lucide-icon name="gauge" [size]="18" class="text-primary dark:text-text-dark" aria-hidden="true"></lucide-icon>
    </div>
    <div>
      <h3 class="text-sm font-semibold text-primary dark:text-text-dark">Erwartete Lebensdauer</h3>
      <p class="text-xs text-gray-400">Km-Schwellwerte pro Verschleißteil-Kategorie</p>
    </div>
  </div>

  <div class="px-6 py-5">
    <div class="space-y-3">
      <div *ngFor="let cat of lifetimeCategories" class="flex items-center gap-3">
        <span class="text-sm text-gray-700 dark:text-text-dark w-28 flex-shrink-0">{{ cat }}</span>
        <div class="flex items-center gap-2 flex-1">
          <input
            type="number"
            [(ngModel)]="lifetimeSettings[cat]"
            class="form-input flex-1"
            [attr.aria-label]="cat + ' erwartete Lebensdauer in km'"
            min="0"
            step="500"
          />
          <span class="text-xs text-gray-400 flex-shrink-0 w-5">km</span>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2 mt-5">
      <button class="btn-primary" (click)="saveLifetimeSettings()">
        <lucide-icon name="check" [size]="14" aria-hidden="true"></lucide-icon>
        Speichern
      </button>
      <button class="btn-secondary" (click)="resetLifetimeSettings()">
        <lucide-icon name="refresh-cw" [size]="14" aria-hidden="true"></lucide-icon>
        Zurücksetzen
      </button>
    </div>

    <div *ngIf="lifetimeSaved"
         class="mt-3 flex items-center gap-2 text-success text-sm">
      <lucide-icon name="check-circle-2" [size]="14" aria-hidden="true"></lucide-icon>
      Gespeichert
    </div>
  </div>
</div>

<!-- Strava Integration Card -->
<div class="card max-w-lg overflow-hidden">

  <!-- Card header -->
  <div class="px-6 pt-6 pb-4 border-b border-gray-100 dark:border-gray-700 flex items-center gap-3">
    <div class="w-9 h-9 rounded-lg bg-orange-50 flex items-center justify-center flex-shrink-0">
      <span class="text-accent font-black text-sm tracking-tighter">STR</span>
    </div>
    <div>
      <h3 class="text-sm font-semibold text-primary dark:text-text-dark">Strava</h3>
      <p class="text-xs text-gray-400">Aktivitäts-Tracking und km-Synchronisation</p>
    </div>
    <!-- Status pill -->
    <div class="ml-auto">
      <span *ngIf="authService.isStravaConnected"
            class="inline-flex items-center gap-1.5 text-xs font-semibold text-success bg-success/10 px-2.5 py-1 rounded-full">
        <lucide-icon name="check-circle-2" [size]="12" aria-hidden="true"></lucide-icon>
        Verbunden
      </span>
      <span *ngIf="!authService.isStravaConnected"
            class="inline-flex items-center gap-1.5 text-xs font-semibold text-gray-400 bg-gray-100 dark:bg-gray-700 px-2.5 py-1 rounded-full">
        <lucide-icon name="x-circle" [size]="12" aria-hidden="true"></lucide-icon>
        Nicht verbunden
      </span>
    </div>
  </div>

  <!-- Connected view -->
  <div *ngIf="authService.isStravaConnected" class="px-6 py-5">
    <div class="flex flex-col gap-1 mb-5">
      <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Verbunden als</span>
      <span class="text-sm font-medium text-gray-700 dark:text-text-dark mt-0.5">
        {{ authService.currentUser?.vorname ?? 'Strava-Konto' }}
      </span>
    </div>

    <!-- Disconnect button -->
    <button *ngIf="!showConfirm" class="btn-danger" (click)="showConfirm = true">
      <lucide-icon name="unplug" [size]="14" aria-hidden="true"></lucide-icon>
      Verbindung trennen
    </button>

    <!-- Confirm panel -->
    <div *ngIf="showConfirm" class="bg-error/5 border border-error/20 rounded-xl p-4">
      <p class="text-sm font-medium text-gray-700 dark:text-text-dark mb-4">
        Strava-Verbindung wirklich trennen?
      </p>
      <div class="flex gap-2">
        <button class="btn-danger" [disabled]="loading" (click)="disconnect()">
          <lucide-icon *ngIf="loading" name="loader-2" [size]="13" class="animate-spin" aria-hidden="true"></lucide-icon>
          Ja, trennen
        </button>
        <button class="btn-secondary" (click)="showConfirm = false">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Disconnected view -->
  <div *ngIf="!authService.isStravaConnected" class="px-6 py-5">
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-5">
      Verbinde dein Strava-Konto, um Kilometerstand und Aktivitäten automatisch zu synchronisieren.
    </p>
    <button class="btn-primary" [disabled]="loading" (click)="connectWithStrava()">
      <lucide-icon *ngIf="loading" name="loader-2" [size]="14" class="animate-spin" aria-hidden="true"></lucide-icon>
      <lucide-icon *ngIf="!loading" name="cable" [size]="14" aria-hidden="true"></lucide-icon>
      {{ loading ? 'Weiterleitung...' : 'Mit Strava verbinden' }}
    </button>
  </div>

  <!-- Feedback -->
  <div *ngIf="error" class="mx-6 mb-5 p-4 bg-error/10 border border-error/20 rounded-xl text-error text-sm">
    <div class="flex items-start gap-2 mb-3">
      <lucide-icon name="alert-circle" [size]="14" class="mt-0.5 shrink-0" aria-hidden="true"></lucide-icon>
      <span>{{ error }}</span>
    </div>
    <div class="flex gap-2">
      <button class="btn-primary text-xs py-1.5 px-3" [disabled]="loading" (click)="connectWithStrava()">
        <lucide-icon *ngIf="loading" name="loader-2" [size]="12" class="animate-spin" aria-hidden="true"></lucide-icon>
        <lucide-icon *ngIf="!loading" name="cable" [size]="12" aria-hidden="true"></lucide-icon>
        Neu verbinden
      </button>
      <button class="btn-secondary text-xs py-1.5 px-3" (click)="reload()">
        <lucide-icon name="refresh-cw" [size]="12" aria-hidden="true"></lucide-icon>
        Seite neu laden
      </button>
    </div>
  </div>
  <div *ngIf="success" class="mx-6 mb-5 flex items-center gap-2 p-3 bg-success/10 border border-success/20 rounded-xl text-success text-sm">
    <lucide-icon name="check-circle-2" [size]="14" aria-hidden="true"></lucide-icon>
    {{ success }}
  </div>

</div>
