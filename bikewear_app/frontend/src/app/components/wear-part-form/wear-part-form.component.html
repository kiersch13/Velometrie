<div class="card border-t-2 border-accent rounded-t-none mb-6" style="border-top-left-radius:0;border-top-right-radius:0">
  <div class="p-5">
    <h4 class="text-sm font-semibold text-primary dark:text-text-dark mb-4 flex items-center gap-2">
      <lucide-icon name="tag" [size]="14" class="text-accent" aria-hidden="true"></lucide-icon>
      Verschlei√üteil erfassen
    </h4>

    <div *ngIf="error" class="flex items-center gap-2 mb-4 p-3 bg-error/10 border border-error/20 rounded-xl text-error text-sm">
      <lucide-icon name="alert-circle" [size]="14" aria-hidden="true"></lucide-icon>
      {{ error }}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div class="flex flex-col gap-1 relative">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark">Name</label>
        <input
          type="text"
          [(ngModel)]="part.name"
          (input)="onNameInput()"
          (keydown)="onNameKeydown($event)"
          (blur)="onNameBlur()"
          placeholder="z.B. Continental GP5000"
          class="form-input"
          autocomplete="off"
        />
        <!-- Autocomplete dropdown -->
        <ul
          *ngIf="showSuggestions"
          class="absolute z-50 top-full left-0 right-0 mt-1 bg-white dark:bg-bg-dark border border-gray-200 dark:border-gray-700 rounded-xl shadow-card overflow-hidden"
        >
          <li
            *ngFor="let s of suggestions; let i = index"
            (mousedown)="selectSuggestion(s)"
            class="flex items-center gap-3 px-4 py-2.5 cursor-pointer text-sm transition-colors"
            [class.bg-accent]="i === activeSuggestionIndex"
            [class.text-white]="i === activeSuggestionIndex"
            [class.hover:bg-gray-50]="i !== activeSuggestionIndex"
            [class.dark:hover:bg-gray-800]="i !== activeSuggestionIndex"
          >
            <lucide-icon name="tag" [size]="12" class="shrink-0 opacity-60" aria-hidden="true"></lucide-icon>
            <span class="flex-1 truncate">
              <span class="font-medium">{{ s.hersteller }}</span>&nbsp;{{ s.name }}
            </span>
            <span class="text-xs opacity-60 shrink-0">{{ s.kategorie }}</span>
          </li>
        </ul>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark">Kategorie</label>
        <select [(ngModel)]="part.kategorie" class="form-input">
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark flex items-center gap-1.5">
          Einbau Kilometerstand
          <lucide-icon *ngIf="loadingOdometer" name="loader-2" [size]="12" class="animate-spin text-accent" aria-hidden="true"></lucide-icon>
        </label>
        <input type="number" [(ngModel)]="part.einbauKilometerstand" min="0" class="form-input" [disabled]="loadingOdometer" />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark">Einbau Datum</label>
        <input type="date" [(ngModel)]="einbauDatumStr" class="form-input" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5">
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark">
          Ausbau Kilometerstand
          <span class="font-normal text-gray-400 ml-1">(optional)</span>
        </label>
        <input type="number" [(ngModel)]="part.ausbauKilometerstand" min="0" class="form-input" />
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-gray-500 dark:text-text-dark">
          Ausbau Datum
          <span class="font-normal text-gray-400 ml-1">(optional)</span>
        </label>
        <input type="date" [(ngModel)]="ausbauDatumStr" class="form-input" />
      </div>
    </div>

    <div class="pt-4 border-t border-gray-100 dark:border-gray-700">
      <button class="btn-primary" (click)="save()" [disabled]="saving">
        <lucide-icon *ngIf="saving" name="loader-2" [size]="14" class="animate-spin" aria-hidden="true"></lucide-icon>
        {{ saving ? 'Speichert...' : 'Speichern' }}
      </button>
    </div>
  </div>
</div>
